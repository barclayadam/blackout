var __hasProp=Object.prototype.hasOwnProperty,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};(function(window,document,$,ko){var EventBus,ExternalTemplateSource,RequestBuilder,Route,StringTemplateSource,ajax,bo,createCustomEngine,currentFragment,defineRegexValidator,emptyValue,getLabelFor,getMessageCreator,hasPushState,hasValue,koBindingHandlers,labels,location,nativeHistory,nativePushState,nativeReplaceState,notifications,parseDate,regionManagerContextKey,requestDetectionFrame,root,routeStripper,rules,tagBindingProvider,templating,toOrderDirection,today,updateUri,uri,validateModel,validateObservable,validation,windowHistory,windowLocation,withoutTime,_getFragment,_getHash;if(ko===void 0)throw new Error("knockout must be included before boson");koBindingHandlers=ko.bindingHandlers,bo=window.bo={},bo.log={};try{window.console.log()}catch(e){window.console={}}return"debug info warn error".replace(/\w+/g,function(n){return bo.log[n]=function(){var _base;return typeof (_base=window.console[n]||window.console.log||function(){}).apply=="function"?_base.apply(window.console,arguments):void 0}}),bo.utils={toTitleCase:function(str){var convertWord;if(str!=null)return convertWord=function(match){return match.toUpperCase()===match?match:(match=match.replace(/([a-z])([A-Z0-9])/g,function(_,one,two){return""+one+" "+two}),match=match.replace(/\b([A-Z]+)([A-Z])([a-z])/,function(_,one,two,three){return""+one+" "+two+three}),match=match.replace(/^./,function(s){return s.toUpperCase()}))},str.toString().replace(/\b[a-zA-Z0-9]+\b/g,convertWord)},toSentenceCase:function(str){var convertWord;if(str!=null)return convertWord=function(match){return match.toUpperCase()===match?match:(match=match.replace(/([A-Z]{2,})([A-Z])$/g,function(_,one,two){return" "+one+two}),match=match.replace(/([A-Z]{2,})([A-Z])([^$])/g,function(_,one,two,three){return" "+one+" "+two.toLowerCase()+three}),match=match.replace(/([a-z])([A-Z0-9])/g,function(_,one,two){return""+one+" "+two.toLowerCase()}),match=match.replace(/^./,function(s){return s.toLowerCase()}),match)},str=str.toString(),str=str.replace(/\b[a-zA-Z0-9]+\b/g,convertWord),str=str.replace(/^./,function(s){return s.toUpperCase()}),str},asObservable:function(value){return ko.isObservable(value)?value:_.isArray(value)?ko.observableArray(value):ko.observable(value)}},EventBus=function(){var clearAll,publish,subscribe,_subscribers;return _subscribers={},clearAll=function(){return _subscribers={}},subscribe=function(messageName,callback){var message,newToken,_i,_len;if(_.isArray(messageName)){for(_i=0,_len=messageName.length;_i<_len;_i++)message=messageName[_i],subscribe(message,callback);return}return _subscribers[messageName]===void 0&&(_subscribers[messageName]={}),newToken=_.size(_subscribers[messageName]),_subscribers[messageName][newToken]=callback,{unsubscribe:function(){return delete _subscribers[messageName][newToken]}}},publish=function(messageName,args){var indexOfSeparator,messages,msg,subscriber,t,_i,_len,_ref;args==null&&(args={}),bo.log.debug("Publishing "+messageName,args),indexOfSeparator=-1,messages=[messageName];while(messageName=messageName.substring(0,messageName.lastIndexOf(":")))messages.push(messageName);for(_i=0,_len=messages.length;_i<_len;_i++){msg=messages[_i],_ref=_subscribers[msg]||{};for(t in _ref)subscriber=_ref[t],subscriber.call(this,args)}return},{clearAll:clearAll,subscribe:subscribe,publish:publish}},bo.EventBus=EventBus,bo.bus=new bo.EventBus,bo.Uri=function(){function Uri(uri,options){var anchor,_ref,_ref2;options==null&&(options={decode:!0}),this.variables={},anchor=document.createElement("a"),anchor.href=uri,this.path=anchor.pathname,options.decode===!0&&(this.path=decode(this.path)),this.path.charAt(0)!=="/"&&(this.path="/"+this.path),this.fragment=(_ref=anchor.hash)!=null?_ref.substring(1):void 0,this.query=(_ref2=anchor.search)!=null?_ref2.substring(1):void 0,this.variables=queryToObject(this.query),uri.charAt(0)==="/"||uri.charAt(0)==="."?this.isRelative=!0:(this.isRelative=!1,this.scheme=anchor.protocol,this.scheme=this.scheme.substring(0,this.scheme.length-1),this.port=parseInt(anchor.port,10),this.host=anchor.hostname,standardPorts[this.scheme]===this.port&&(this.port=null))}var convertToType,decode,encode,objectToQuery,queryStringVariable,queryToObject,standardPorts;return encode=encodeURIComponent,decode=decodeURIComponent,standardPorts={http:80,https:443},queryStringVariable=function(name,value){var t;return t=encode(name),value=value.toString(),value.length>0&&(t+="="+encode(value)),t},objectToQuery=function(variables){var name,tmp,v,val,_i,_len;tmp=[];for(name in variables){val=variables[name];if(val!==null)if(_.isArray(val))for(_i=0,_len=val.length;_i<_len;_i++)v=val[_i],v!==null&&tmp.push(queryStringVariable(name,v));else tmp.push(queryStringVariable(name,val))}return tmp.length&&tmp.join("&")},convertToType=function(value){var asNumber,valueLower;if(value==null)return;return valueLower=value.toLowerCase(),valueLower==="true"||valueLower==="false"?value==="true":(asNumber=parseFloat(value),_.isNaN(asNumber)?value:asNumber)},queryToObject=function(qs){var key,p,query,split,value,_i,_len,_ref;if(!qs)return{};qs=qs.replace(/^[^?]*\?/,""),qs=qs.replace(/&$/,""),qs=qs.replace(/\+/g," "),query={},_ref=qs.split("&");for(_i=0,_len=_ref.length;_i<_len;_i++)p=_ref[_i],split=p.split("="),key=decode(split[0]),value=convertToType(decode(split[1])),query[key]?(_.isArray(query[key])||(query[key]=[query[key]]),query[key].push(value)):query[key]=value;return query},Uri.prototype.clone=function(){return new bo.Uri(this.toString())},Uri.prototype.toString=function(){var q,s;return s="",q=objectToQuery(this.variables),this.scheme&&(s=this.scheme+"://"),this.host&&(s+=this.host),this.port&&(s+=":"+this.port),this.path&&(s+=this.path),q&&(s+="?"+q),this.fragment&&(s+="#"+this.fragment),s},Uri}(),ajax=bo.ajax={},requestDetectionFrame=[],RequestBuilder=function(){function RequestBuilder(url){this.url=url,this.properties={}}var doCall;return doCall=function(httpMethod,requestBuilder){var ajaxRequest,failureHandlerRegistered,getDeferred,promise,requestOptions;return getDeferred=$.Deferred(),failureHandlerRegistered=!1,requestOptions=_.defaults(requestBuilder.properties,{url:requestBuilder.url,type:httpMethod}),ajaxRequest=$.ajax(requestOptions),bo.bus.publish("ajaxRequestSent:"+requestBuilder.url,{path:requestBuilder.url,method:httpMethod}),ajaxRequest.done(function(response){return bo.bus.publish("ajaxResponseReceived:success:"+requestBuilder.url,{path:requestBuilder.url,method:httpMethod,response:response,status:200}),getDeferred.resolve(response)}),ajaxRequest.fail(function(response){var failureMessage;return failureMessage={path:requestBuilder.url,method:httpMethod,responseText:response.responseText,status:response.status},bo.bus.publish("ajaxResponseReceived:failure:"+requestBuilder.url,failureMessage),failureHandlerRegistered||bo.bus.publish("ajaxResponseFailureUnhandled:"+requestBuilder.url,failureMessage),getDeferred.reject(response)}),promise=getDeferred.promise(),promise.fail=function(callback){return failureHandlerRegistered=!0,getDeferred.fail(callback)},requestDetectionFrame.push(promise),promise},RequestBuilder.prototype.get=function(){return doCall("GET",this)},RequestBuilder.prototype.post=function(){return doCall("POST",this)},RequestBuilder.prototype.put=function(){return doCall("PUT",this)},RequestBuilder.prototype["delete"]=function(){return doCall("DELETE",this)},RequestBuilder.prototype.head=function(){return doCall("HEAD",this)},RequestBuilder}(),ajax.url=function(url){return new RequestBuilder(url)},ajax.listen=function(f){return requestDetectionFrame=[],f(),$.when.apply(this,requestDetectionFrame)},"local session".replace(/\w+/g,function(type){return ko.extenders[type+"Storage"]=function(target,key){var stored;return stored=window[type+"Storage"].getItem(key),stored!=null&&target(JSON.parse(stored).value),target.subscribe(function(newValue){return window[type+"Storage"].setItem(key,JSON.stringify({value:newValue}))}),target}}),notifications=bo.notifications={},"success warning error".replace(/\w+/g,function(level){return notifications[level]=function(text){return bo.bus.publish("notification:"+level,{text:text,level:level})}}),templating=bo.templating={},StringTemplateSource=function(){function StringTemplateSource(templateName){this.templateName=templateName}return StringTemplateSource.prototype.text=function(value){return ko.utils.unwrapObservable(templating.templates[this.templateName])},StringTemplateSource}(),ExternalTemplateSource=function(){function ExternalTemplateSource(templateName){this.templateName=templateName,this.stringTemplateSource=new StringTemplateSource(this.templateName)}return ExternalTemplateSource.prototype.text=function(value){var loadingPromise,template;return templating.templates[this.templateName]===void 0&&(template=ko.observable(templating.loadingTemplate),templating.set(this.templateName,template),loadingPromise=templating.loadExternalTemplate(this.templateName),loadingPromise.done(template)),this.stringTemplateSource.text.apply(this.stringTemplateSource,arguments)},ExternalTemplateSource}(),createCustomEngine=function(templateEngine){var originalMakeTemplateSource;return originalMakeTemplateSource=templateEngine.makeTemplateSource,templateEngine.makeTemplateSource=function(template){return templating.templates[template]!=null?new StringTemplateSource(template):templating.isExternal(template)?new ExternalTemplateSource(template):originalMakeTemplateSource(template)},templateEngine},ko.setTemplateEngine(createCustomEngine(new ko.nativeTemplateEngine)),templating.loadingTemplate="Loading...",templating.isExternal=function(name){return name.indexOf&&name.indexOf(!1)},templating.externalPath="/Templates/Get/{name}",templating.loadExternalTemplate=function(name){var path;return name=name.substring(2),path=templating.externalPath.replace("{name}",name),bo.ajax.url(path).get()},templating.reset=function(){return templating.templates={_data:{}}},templating.set=function(name,template){return ko.isWriteableObservable(templating.templates[name])?templating.templates[name](template):templating.templates[name]=template},templating.reset(),validation=bo.validation={},getMessageCreator=function(propertyRules,ruleName){return propertyRules[""+ruleName+"Message"]||bo.validation.rules[ruleName].message||"The field is invalid"},validation.formatErrorMessage=function(msg){return msg},validateObservable=function(observableValue,model){var errors,isValid,msgCreator,rule,ruleName,ruleOptions,rules,value;errors=[],rules=observableValue.validationRules,value=observableValue.peek();for(ruleName in rules)ruleOptions=rules[ruleName],rule=bo.validation.rules[ruleName],rule!=null&&(isValid=rule.validator(value,ruleOptions,model),isValid||(msgCreator=getMessageCreator(rules,ruleName),_.isFunction(msgCreator)?errors.push(validation.formatErrorMessage(msgCreator(ruleOptions))):errors.push(validation.formatErrorMessage(msgCreator))));return observableValue.errors(errors),observableValue.isClientValid(errors.length===0)},validateModel=function(model,parent){var item,propName,propValue,unwrapped,valid,_i,_len;valid=!0;if(model!=null){model.validate!=null&&model.validationRules!=null&&(model.validate(parent),valid=model.isClientValid()&&valid),ko.isObservable(model)?unwrapped=model.peek():unwrapped=model;if(_.isObject(unwrapped))for(propName in unwrapped){if(!__hasProp.call(unwrapped,propName))continue;propValue=unwrapped[propName],valid=validateModel(propValue,propName,model)&&valid}if(_.isArray(unwrapped))for(_i=0,_len=unwrapped.length;_i<_len;_i++)item=unwrapped[_i],validateModel(item,model)}return valid},validation.mixin=function(model){return model.validate=function(){return model.validated()||(ko.computed(function(){return model.isClientValid(validateModel(model))}),model.validated(!0)),model.serverErrors([])},model.validated=ko.observable(!1),model.isClientValid=ko.observable(),model.serverErrors=ko.observable([]),model.setServerErrors=function(errors){var key,value;for(key in model){if(!__hasProp.call(model,key))continue;value=model[key],(value!=null?value.serverErrors:void 0)!=null&&(value.serverErrors(_.flatten([errors[key]]||[])),delete errors[key])}return model.serverErrors(_.flatten(_.values(errors)))}},validation.newModel=function(model){return model==null&&(model={}),validation.mixin(model),model},ko.extenders.validationRules=function(target,validationRules){return validationRules==null&&(validationRules={}),target.validationRules=validationRules,target.validate=_.once(function(parentModel){var doValidate;return doValidate=function(){return target.validated(!0),validateObservable(target,parentModel)},target.subscribe(doValidate),doValidate()}),target.validated=ko.observable(!1),target.errors=ko.observable([]),target.isClientValid=ko.observable(!0),target.serverErrors=ko.observable([]),target.subscribe(function(){return target.serverErrors([])}),target},ko.subscribable.fn.addValidationRules=function(validationRules){return ko.extenders.validationRules(this,validationRules)},hasValue=function(value){return value!=null&&(!value.replace||value.replace(/[ ]/g,"")!=="")},emptyValue=function(value){return!hasValue(value)},parseDate=function(value){if(_.isDate(value))return value},withoutTime=function(dateTime){if(dateTime!=null)return new Date(dateTime.getYear(),dateTime.getMonth(),dateTime.getDate())},today=function(){return withoutTime(new Date)},labels=document.getElementsByTagName("label"),getLabelFor=function(element){return _.find(labels,function(l){return l.getAttribute("for")===element.id})},rules={required:{validator:function(value,options){return hasValue(value)},message:"This field is required",modifyElement:function(element,options){var label;element.setAttribute("aria-required","true"),element.setAttribute("required","required"),label=getLabelFor(element);if(label)return ko.utils.toggleDomNodeCssClass(element,"required",!0)}},regex:{validator:function(value,options){return emptyValue(value)||options.test(value)},message:"This field is invalid",modifyElement:function(element,options){return element.setAttribute("pattern",""+options)}},numeric:{validator:function(value,options){return emptyValue(value)||isFinite(value)},message:function(options){return"This field must be numeric"},modifyElement:function(element,options){return element.setAttribute("type","numeric")}},integer:{validator:function(value,options){return emptyValue(value)||/^[0-9]+$/.test(value)},message:"This field must be a whole number",modifyElement:function(element,options){return element.setAttribute("type","numeric")}},exactLength:{validator:function(value,options){return emptyValue(value)||value.length!=null&&value.length===options},message:function(options){return"This field must be exactly "+options+" characters long"},modifyElement:function(element,options){return element.setAttribute("maxLength",options)}},minLength:{validator:function(value,options){return emptyValue(value)||value.length!=null&&value.length>=options},message:function(options){return"This field must be at least "+options+" characters long"}},maxLength:{validator:function(value,options){return emptyValue(value)||value.length!=null&&value.length<=options},message:function(options){return"This field must be no more than "+options+" characters long"},modifyElement:function(element,options){return element.setAttribute("maxLength",options)}},rangeLength:{validator:function(value,options){return rules.minLength.validator(value,options[0])&&rules.maxLength.validator(value,options[1])},message:function(options){return"This field must be between "+options[0]+" and "+options[1]+" characters long"},modifyElement:function(element,options){return element.setAttribute("maxLength",""+options[1])}},min:{validator:function(value,options){return emptyValue(value)||value>=options},message:function(options){return"This field must be equal to or greater than "+options},modifyElement:function(element,options){return element.setAttribute("min",options),element.setAttribute("aria-valuemin",options)}},moreThan:{validator:function(value,options){return emptyValue(value)||value>options},message:function(options){return"This field must be greater than "+options+"."}},max:{validator:function(value,options){return emptyValue(value)||value<=options},message:function(options){return"This field must be equal to or less than "+options},modifyElement:function(element,options){return element.setAttribute("max",options),element.setAttribute("aria-valuemax",options)}},lessThan:{validator:function(value,options){return emptyValue(value)||value<options},message:function(options){return"This field must be less than "+options+"."}},range:{validator:function(value,options){return rules.min.validator(value,options[0])&&rules.max.validator(value,options[1])},message:function(options){return"This field must be between "+options[0]+" and "+options[1]},modifyElement:function(element,options){return rules.min.modifyElement(element,options[0]),rules.max.modifyElement(element,options[1])}},maxDate:{validator:function(value,options){return emptyValue(value)||parseDate(value)<=parseDate(options)},message:function(options){return"This field must be on or before "+options[0]}},minDate:{validator:function(value,options){return emptyValue(value)||parseDate(value)>=parseDate(options)},message:function(options){return"This field must be on after "+options[0]}},inFuture:{validator:function(value,options){return options==="Date"?emptyValue(value)||withoutTime(parseDate(value))>today():emptyValue(value)||parseDate(value)>new Date},message:"This field must be in the future"},inPast:{validator:function(value,options){return options==="Date"?emptyValue(value)||withoutTime(parseDate(value))<today():emptyValue(value)||parseDate(value)<new Date},message:"This field must be in the past"},notInPast:{validator:function(value,options){return options==="Date"?emptyValue(value)||withoutTime(parseDate(value))>=today():emptyValue(value)||parseDate(value)>=new Date},message:"This field must not be in the past"},notInFuture:{validator:function(value,options){return options==="Date"?emptyValue(value)||withoutTime(parseDate(value))<=today():emptyValue(value)||parseDate(value)<=new Date},message:"This field must not be in the future"},requiredIf:{validator:function(value,options,model){var valueToCheckAgainst,valueToCheckAgainstInList;if(options.equalsOneOf===void 0)throw new Error("You need to provide a list of items to check against.");if(options.value===void 0&&options.property===void 0)throw new Error("You need to provide either a property or a value.");if(options.property!=null&&!_.has(model,options.property))throw new Error("The property "+options.property+" cannot be found.");return valueToCheckAgainst=options.value||model[options.property],valueToCheckAgainst=ko.utils.unwrapObservable(valueToCheckAgainst)||null,valueToCheckAgainstInList=_.any(options.equalsOneOf,function(v){return(v||null)===valueToCheckAgainst}),valueToCheckAgainstInList?hasValue(value):!0},message:"This field is required"},requiredIfNot:{validator:function(value,options,model){var valueToCheckAgainst,valueToCheckAgainstNotInList;if(options.equalsOneOf===void 0)throw new Error("You need to provide a list of items to check against.");if(options.value===void 0&&options.property===void 0)throw new Error("You need to provide either a property or a value.");if(options.property!=null&&!_.has(model,options.property))throw new Error("The property "+options.property+" cannot be found.");return valueToCheckAgainst=options.value||model[options.property],valueToCheckAgainst=ko.utils.unwrapObservable(valueToCheckAgainst)||null,valueToCheckAgainstNotInList=_.all(options.equalsOneOf,function(v){return(v||null)!==valueToCheckAgainst}),valueToCheckAgainstNotInList?hasValue(value):!0},message:"This field is required"},equalTo:{validator:function(value,options,model){return options.value!=null?emptyValue(value)||value===ko.utils.unwrapObservable(options.value):emptyValue(value)||value===ko.utils.unwrapObservable(model[options])},message:function(options){return options.value!=null?"This field must be equal to "+options.value+".":"This field must be equal to "+options+"."}},custom:{validator:function(value,options,model){if(!_.isFunction(options))throw new Error("Must pass a function to the 'custom' validator");return options(value,model)},message:"This field is invalid."}},defineRegexValidator=function(name,regex){return rules[name]={validator:function(value,options){return rules.regex.validator(value,regex)},message:"This field is an invalid "+name,modifyElement:function(element,options){return rules.regex.modifyElement(element,regex)}}},defineRegexValidator("email",/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/i),defineRegexValidator("postcode",/(GIR ?0AA)|((([A-Z][0-9]{1,2})|(([A-Z][A-HJ-Y][0-9]{1,2})|(([A-Z][0-9][A-Z])|([A-Z][A-HJ-Y][0-9]?[A-Z])))) ?[0-9][A-Z]{2})/i),bo.validation.rules=rules,toOrderDirection=function(order){return order===void 0||order==="asc"||order==="ascending"?"ascending":"descending"},bo.DataSource=function(){function DataSource(options){this.options=options,this.isLoading=ko.observable(!1),this._hasLoadedOnce=!1,this._serverPagingEnabled=this.options.serverPaging>0,this._clientPagingEnabled=this.options.clientPaging>0,this.pagingEnabled=this._serverPagingEnabled||this._clientPagingEnabled,this._loadedItems=ko.observableArray(),this._sortByAsString=ko.observable(),this._sortByDetails=ko.observable(),this._sortByDetails.subscribe(__bind(function(newValue){var normalised;return normalised=_.reduce(newValue,function(memo,o){var prop;return prop=""+o.name+" "+toOrderDirection(o.order),memo?""+memo+", "+prop:prop},""),this._sortByAsString(normalised)},this)),this.sortBy=ko.computed({read:this._sortByAsString,write:__bind(function(value){var properties;return properties=_(value.split(",")).map(function(p){var indexOfSpace;return p=ko.utils.stringTrim(p),indexOfSpace=p.indexOf(" "),indexOfSpace>-1?{name:p.substring(0,indexOfSpace),order:toOrderDirection(p.substring(indexOfSpace+1))}:{name:p,order:"ascending"}}),this._sortByDetails(properties)},this)}),this.items=ko.computed(__bind(function(){return this._sortByDetails()!=null&&!this._serverPagingEnabled?this._loadedItems().sort(__bind(function(a,b){var p,_i,_len,_ref;_ref=this._sortByDetails();for(_i=0,_len=_ref.length;_i<_len;_i++){p=_ref[_i];if(a[p.name]>b[p.name])return p.order==="ascending"?1:-1;if(a[p.name]<b[p.name])return p.order==="ascending"?-1:1}return 0},this)):this._loadedItems()},this)),this.options.searchParameters!=null?(this.searchParameters=ko.computed(function(){return ko.toJS(options.searchParameters)}),this.searchParameters.subscribe(__bind(function(){if(this._hasLoadedOnce)return this.load()},this))):this.searchParameters=ko.observable({}),this._setupPaging(),this._setupInitialData()}return DataSource.prototype.getPropertySortOrder=function(propertyName){var ordering,sortedBy;sortedBy=this._sortByDetails();if(sortedBy!=null&&sortedBy.length>0)return ordering=_.find(sortedBy,function(o){return o.name===propertyName}),ordering!=null?ordering.order:void 0},DataSource.prototype.remove=function(item){return this._loadedItems.remove(item)},DataSource.prototype.load=function(){var currentPageNumber;currentPageNumber=this.pageNumber(),this.pageNumber(1);if(!this._serverPagingEnabled||currentPageNumber===1)return this._doLoad()},DataSource.prototype.goTo=function(pageNumber){return this.pageNumber(pageNumber)},DataSource.prototype.goToFirstPage=function(){return this.goTo(1)},DataSource.prototype.goToLastPage=function(){return this.goTo(this.pageCount())},DataSource.prototype.goToNextPage=function(){if(!this.isLastPage())return this.goTo(this.pageNumber()+1)},DataSource.prototype.goToPreviousPage=function(){if(!this.isFirstPage())return this.goTo(this.pageNumber()-1)},DataSource.prototype._setupInitialData=function(){this.options.provider!=null&&_.isArray(this.options.provider)&&(this._setData(this.options.provider),this.goTo(1)),this.options.initialSortOrder!=null&&this.sortBy(this.options.initialSortOrder);if(this.options.autoLoad===!0)return this.load()},DataSource.prototype._setupPaging=function(){this._lastProviderOptions=-1,this.clientPagesPerServerPage=this.options.serverPaging/(this.options.clientPaging||this.options.serverPaging),this.pageSize=ko.observable(),this.totalCount=ko.observable(0),this.pageNumber=ko.observable().extend({publishable:{message:function(p){return"pageChanged:"+p()},bus:this}}),this.pageItems=ko.computed(__bind(function(){var end,start;return this._clientPagingEnabled&&this._serverPagingEnabled?(start=(this.pageNumber()-1)%this.clientPagesPerServerPage*this.pageSize(),end=start+this.pageSize(),this.items().slice(start,end)):this._clientPagingEnabled?(start=(this.pageNumber()-1)*this.pageSize(),end=start+this.pageSize(),this.items().slice(start,end)):this.items()},this)),this.pageCount=ko.computed(__bind(function(){return this.totalCount()?Math.ceil(this.totalCount()/this.pageSize()):0},this)),this.isFirstPage=ko.computed(__bind(function(){return this.pageNumber()===1},this)),this.isLastPage=ko.computed(__bind(function(){return this.pageNumber()===this.pageCount()||this.pageCount()===0},this));if(this.options.serverPaging)return this.pageNumber.subscribe(__bind(function(){return this._doLoad()},this)),this.sortBy.subscribe(__bind(function(){return this._doLoad()},this))},DataSource.prototype._doLoad=function(){var loadOptions;if(_.isArray(this.options.provider))return;loadOptions=_.extend({},this.searchParameters()),this._serverPagingEnabled&&(loadOptions.pageSize=this.options.serverPaging,loadOptions.pageNumber=Math.ceil(this.pageNumber()/this.clientPagesPerServerPage)),this.sortBy()!=null&&(loadOptions.orderBy=this.sortBy());if(_.isEqual(loadOptions,this._lastProviderOptions))return;return this.isLoading(!0),this.options.provider(loadOptions,__bind(function(loadedData){return this._setData(loadedData),this._lastProviderOptions=loadOptions,this.isLoading(!1)},this),this)},DataSource.prototype._setData=function(loadedData){var items;return items=[],this.options.serverPaging?(items=loadedData.items,this.pageSize(this.options.clientPaging||this.options.serverPaging),this.totalCount(loadedData.totalCount||loadedData.totalItems||0)):(items=loadedData,this.pageSize(this.options.clientPaging||loadedData.length),this.totalCount(loadedData.length)),this.options.map!=null&&(items=_.chain(items).map(this.options.map).compact().value()),this._loadedItems(items),this._hasLoadedOnce=!0},DataSource}(),location=bo.location={},windowHistory=window.history,windowLocation=window.location,routeStripper=/^[#\/]/,hasPushState=!!windowHistory&&!!windowHistory.pushState,_getHash=function(){var match;return match=windowLocation.href.match(/#(.*)$/),match?match[1]:""},_getFragment=function(){var fragment;return hasPushState?(fragment=windowLocation.pathname,fragment+=windowLocation.search||""):fragment=_getHash(),fragment.replace(routeStripper,""),fragment=fragment.replace(/\/\//g,"/"),fragment.charAt(0)!=="/"&&(fragment="/"+fragment),fragment,decodeURI(fragment)},uri=location.uri=ko.observable(),updateUri=function(){return location.uri(new bo.Uri(document.location.toString()))},updateUri(),location.host=function(){return uri().host},location.path=ko.computed(function(){return uri().path}),location.fragment=ko.computed(function(){return uri().fragment||""}),location.query=ko.computed(function(){return uri().query}),location.variables=ko.computed(function(){return uri().variables}),location.routeVariables=ko.computed({read:function(){return uri(),(new bo.Uri(_getFragment())).variables},deferEvaluation:!0}),location.routeVariables.set=function(key,value,options){var currentUri;return currentUri=new bo.Uri(location.routePath()),currentUri.variables[key]=value,location.routePath(currentUri.toString(),{replace:options.history===!1})},location.routePath=ko.computed({read:function(){return uri(),(new bo.Uri(_getFragment())).path},write:function(newPath,options){return options==null&&(options={}),location.routePath()===newPath?!1:(options.replace===!0?windowHistory.replaceState(null,document.title,newPath):windowHistory.pushState(null,document.title,newPath),updateUri(),bo.bus.publish("urlChanged:internal",{url:_getFragment(),path:location.routePath(),variables:location.routeVariables(),external:!1}))}}),location.reset=function(){return updateUri()},ko.utils.registerEventHandler(window,"popstate",function(){return updateUri(),bo.bus.publish("urlChanged:external",{url:_getFragment(),path:location.routePath(),variables:location.routeVariables(),external:!0})}),hasPushState?(nativeHistory=windowHistory,nativePushState=windowHistory.pushState,nativeReplaceState=windowHistory.replaceState,windowHistory.pushState=function(state,title,frag){return nativePushState.call(nativeHistory,state,title,frag),document.title=title,updateUri()},windowHistory.replaceState=function(state,title,frag){return nativeReplaceState.call(nativeHistory,state,title,frag),document.title=title,updateUri()}):(currentFragment=void 0,!hasPushState&&window.onhashchange!==void 0&&ko.utils.registerEventHandler(window,"hashchange",function(){var current;current=_getFragment();if(current!==currentFragment)return hasPushState||ko.utils.triggerEvent(window,"popstate"),currentFragment=current}),windowHistory.pushState=function(_,title,frag){return windowLocation.hash=frag,document.title=title,updateUri()},windowHistory.replaceState=function(_,title,frag){return windowLocation.replace(windowLocation.toString().replace(/#.*$/,"")+"#"+frag),document.title=title,updateUri()}),bo.routing={},Route=function(){function Route(name,url,callback,options){var routeDefinitionAsRegex;this.name=name,this.url=url,this.callback=callback,this.options=options,this.title=options.title,this.requiredParams=[],this.paramNames=[],routeDefinitionAsRegex=this.url.replace(paramRegex,__bind(function(_,mode,name){return this.paramNames.push(name),mode!=="*"&&this.requiredParams.push(name),mode==="*"?"(.*)":"([^/]*)"},this)),routeDefinitionAsRegex.length>1&&routeDefinitionAsRegex.charAt(0)==="/"&&(routeDefinitionAsRegex=routeDefinitionAsRegex.substring(1)),this.incomingMatcher=new RegExp(""+routeDefinitionAsRegex+"/?$","i")}var paramRegex;return paramRegex=/{(\*?)(\w+)}/g,Route.prototype.match=function(path){var index,matches,name,params,_len,_ref;matches=path.match(this.incomingMatcher);if(matches){params={},_ref=this.paramNames;for(index=0,_len=_ref.length;index<_len;index++)name=_ref[index],params[name]=matches[index+1];return params}},Route.prototype.buildUrl=function(parameters){parameters==null&&(parameters={});if(this._allRequiredParametersPresent(parameters))return this.url.replace(paramRegex,__bind(function(_,mode,name){return ko.utils.unwrapObservable(parameters[name]||"")},this))},Route.prototype._allRequiredParametersPresent=function(parameters){return _.all(this.requiredParams,function(p){return parameters[p]!=null})},Route.prototype.toString=function(){return""+this.name+": "+this.url},Route}(),root="/",bo.routing.Router=function(){function Router(){this.routes={},bo.bus.subscribe("urlChanged:external",__bind(function(msg){var matchedRoute;return matchedRoute=this.getRouteFromUrl(msg.url),matchedRoute===void 0?bo.bus.publish("routeNotFound",{url:msg.url}):this._doNavigate(msg.path,matchedRoute.route,matchedRoute.parameters)},this))}return Router.prototype._doNavigate=function(url,route,parameters){return typeof route.callback=="function"&&route.callback(parameters),bo.bus.publish("routeNavigated:"+route.name,{route:route,parameters:parameters}),this.currentUrl=url},Router.prototype.route=function(name,url,callback,options){return options==null&&(options={title:name}),this.routes[name]=new Route(name,url,callback,options),this},Router.prototype.getRouteFromUrl=function(url){var match,matchedParams,name,path,r,_ref;path=(new bo.Uri(url,{decode:!0})).path,match=void 0,_ref=this.routes;for(name in _ref)r=_ref[name],matchedParams=r.match(path),matchedParams!=null&&(match={route:r,parameters:matchedParams});return match},Router.prototype.getNamedRoute=function(name){return this.routes[name]},Router.prototype.navigateTo=function(name,parameters){var route,url;return parameters==null&&(parameters={}),url=this.buildUrl(name,parameters),url!=null?(route=this.getNamedRoute(name),this._doNavigate(url,route,parameters),bo.location.routePath(url),document.title=route.title,!0):!1},Router.prototype.buildUrl=function(name,parameters){var route,url;return route=this.getNamedRoute(name),url=route!=null?route.buildUrl(parameters):void 0,route===void 0&&bo.log.warn("The route '"+name+"' could not be found."),url===void 0&&bo.log.warn("The parameters specified are not valid for the '"+name+"' route."),url},Router}(),tagBindingProvider=function(){var findTagCompatibleBindingHandlerName,mergeAllAttributes,processBindingHandlerTagDefinition,realBindingProvider;return realBindingProvider=new ko.bindingProvider,processBindingHandlerTagDefinition=function(bindingHandler){var split;if(_.isString(bindingHandler.tag))return split=bindingHandler.tag.split("->"),split.length===1?bindingHandler.tag={appliesTo:split[0].toUpperCase()}:bindingHandler.tag={appliesTo:split[0].toUpperCase(),replacedWith:split[1]}},mergeAllAttributes=function(source,destination){var attr,_i,_len,_ref,_results;if(document.body.mergeAttributes)return destination.mergeAttributes(source,!1);_ref=source.attributes,_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++)attr=_ref[_i],_results.push(destination.setAttribute(attr.name,attr.value));return _results},findTagCompatibleBindingHandlerName=function(node){var tagName;if(node.tagHandler!=null)return node.tagHandler;tagName=node.tagName;if(tagName!=null)return _.find(_.keys(koBindingHandlers),function(key){var bindingHandler;return bindingHandler=koBindingHandlers[key],processBindingHandlerTagDefinition(bindingHandler),bindingHandler.tag!=null&&bindingHandler.tag.appliesTo===tagName})},this.preprocessNode=function(node){var nodeReplacement,tagBindingHandler,tagBindingHandlerName,_ref;tagBindingHandlerName=findTagCompatibleBindingHandlerName(node),tagBindingHandler=koBindingHandlers[tagBindingHandlerName];if(tagBindingHandlerName&&((_ref=tagBindingHandler.tag)!=null?_ref.replacedWith:void 0)!=null)return nodeReplacement=document.createElement(tagBindingHandler.tag.replacedWith),mergeAllAttributes(node,nodeReplacement),nodeReplacement.tagHandler=tagBindingHandlerName,ko.utils.replaceDomNodes(node,[nodeReplacement]),nodeReplacement},this.nodeHasBindings=function(node,bindingContext){var isCompatibleTagHandler,tagBindingHandler;return tagBindingHandler=findTagCompatibleBindingHandlerName(node),isCompatibleTagHandler=tagBindingHandler!==void 0,realBindingProvider.nodeHasBindings(node,bindingContext)||isCompatibleTagHandler},this.getBindings=function(node,bindingContext){var existingBindings,options,optionsAttribute,tagBindingHandlerName;return existingBindings=realBindingProvider.getBindings(node,bindingContext),tagBindingHandlerName=findTagCompatibleBindingHandlerName(node),tagBindingHandlerName!==void 0&&(existingBindings||(existingBindings={}),options=!0,optionsAttribute=node.getAttribute("data-option"),optionsAttribute&&(optionsAttribute=""+tagBindingHandlerName+": "+optionsAttribute,options=realBindingProvider.parseBindingsString(optionsAttribute,bindingContext),options=options[tagBindingHandlerName]),existingBindings[tagBindingHandlerName]=options),existingBindings},this},ko.bindingProvider.instance=new tagBindingProvider,bo.ViewModel={extend:function(definition){var key,value,viewModel;viewModel=function(){};for(key in definition){if(!__hasProp.call(definition,key))continue;value=definition[key],_.isFunction(value)||(viewModel.prototype[key]=value)}return viewModel}},koBindingHandlers.part={init:function(element,valueAccessor){var realValueAccessor,viewModel;return viewModel=ko.utils.unwrapObservable(valueAccessor()||{}),realValueAccessor=function(){return{data:viewModel,name:viewModel.viewName}},koBindingHandlers.template.init(element,realValueAccessor)},update:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var deferred,lastViewModel,realValueAccessor;viewModel=ko.utils.unwrapObservable(valueAccessor());if(viewModel==null)return;return realValueAccessor=function(){return{data:viewModel,name:viewModel.viewName}},lastViewModel=ko.utils.domData.get(element,"__part__lastViewModel"),lastViewModel!=null&&lastViewModel.hide!=null&&lastViewModel.hide(),deferred=new $.Deferred,viewModel.beforeShow!=null?deferred=bo.ajax.listen(function(){return viewModel.beforeShow()}):deferred.resolve(),deferred.done(function(){return koBindingHandlers.template.update(element,realValueAccessor,allBindingsAccessor,viewModel,bindingContext),viewModel.show!=null&&viewModel.show(),ko.utils.domData.set(element,"__part__lastViewModel",viewModel)})}},regionManagerContextKey="$regionManager",bo.RegionManager=function(){function RegionManager(){this.defaultRegion=void 0,this.regions={}}return RegionManager.prototype.show=function(viewModel){if(_.keys(this.regions).length===1)return this.regions[_.keys(this.regions)[0]](viewModel);if(this.defaultRegion!=null)return this.regions[this.defaultRegion](viewModel);throw new Error("Cannot use show when multiple regions exist")},RegionManager.prototype.showAll=function(viewModels){var regionKey,vm;for(regionKey in viewModels){vm=viewModels[regionKey];if(this.regions[regionKey]===void 0)throw new Error("This region manager does not have a '"+regionKey+"' region.");this.regions[regionKey](vm)}return},RegionManager.prototype.register=function(name,isDefault){return isDefault&&(this.defaultRegion=name),this.regions[name]=ko.observable()},RegionManager.prototype.get=function(name){return this.regions[name]()},RegionManager}(),koBindingHandlers.regionManager={init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var innerBindingContext,regionManager,regionManagerProperties;return regionManager=ko.utils.unwrapObservable(valueAccessor()),regionManagerProperties={},regionManagerProperties[regionManagerContextKey]=regionManager,innerBindingContext=bindingContext.extend(regionManagerProperties),ko.applyBindingsToDescendants(innerBindingContext,element),{controlsDescendantBindings:!0}}},koBindingHandlers.region={tag:"region->div",init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var isDefault,regionId,regionManager;regionManager=bindingContext[regionManagerContextKey];if(regionManager===void 0)throw new Error("region binding handler / tag must be a child of a regionManager");return regionId=element.id||"main",isDefault=element.getAttribute("data-default")==="true",regionManager.register(regionId,isDefault),koBindingHandlers.part.init(element,function(){return{}},allBindingsAccessor,viewModel,bindingContext)},update:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var regionId,regionManager;return regionManager=bindingContext[regionManagerContextKey],regionId=element.id||"main",koBindingHandlers.part.update(element,function(){return regionManager.get(regionId)},allBindingsAccessor,viewModel,bindingContext)}}})(window,document,window.jQuery,window.ko)